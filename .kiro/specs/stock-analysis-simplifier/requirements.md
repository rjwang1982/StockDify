# 需求文档

## 简介

本功能旨在扩展现有的股票分析工作流，在专业分析报告生成后，将结果发送给另一个大模型（如腾讯元宝）进行二次处理，输出投资小白都能听懂的通俗易懂版本。

## 术语表

- **原始工作流**: 现有的股票分析工作流，包含数据获取、解析和专业分析
- **简化器节点**: 新增的 LLM 节点，负责将专业术语转换为通俗语言
- **DSL 文件**: Dify 应用的配置文件，采用 YAML 格式
- **腾讯元宝**: 腾讯推出的大语言模型服务

## 需求

### 需求 1

**用户故事:** 作为投资新手，我希望在获得专业股票分析后，能看到一个用简单语言解释的版本，以便我能理解分析内容并做出投资决策

#### 验收标准

1. WHEN 原始工作流的 AI 投资分析节点完成输出，THE 简化器节点 SHALL 接收该输出作为输入
2. THE 简化器节点 SHALL 使用腾讯元宝或其他大模型 API 进行文本转换
3. THE 简化器节点 SHALL 将专业术语（如 RSI、MACD、支撑位、压力位）转换为通俗易懂的解释
4. THE 简化器节点 SHALL 保留关键的投资建议信息（买入/卖出建议、目标价位、止损位）
5. THE 新工作流 SHALL 在最终输出中同时包含专业版和小白版两个分析结果

### 需求 2

**用户故事:** 作为系统管理员，我希望能够灵活配置使用哪个大模型进行简化处理，以便根据成本和效果选择最合适的服务

#### 验收标准

1. THE DSL 文件 SHALL 支持通过环境变量配置简化器使用的模型提供商
2. THE DSL 文件 SHALL 支持配置模型的温度参数和最大 token 数
3. WHERE 配置了腾讯元宝 API，THE 简化器节点 SHALL 使用腾讯元宝进行处理
4. WHERE 未配置特定模型，THE 简化器节点 SHALL 使用默认的通义千问模型

### 需求 3

**用户故事:** 作为开发者，我希望新的 DSL 文件保持与原工作流的兼容性，以便能够平滑升级而不影响现有功能

#### 验收标准

1. THE 新 DSL 文件 SHALL 保留原工作流的所有节点和连接
2. THE 新 DSL 文件 SHALL 在原有流程基础上添加新节点，而不修改现有节点逻辑
3. THE 新工作流 SHALL 保持原有的输入参数（股票代码、市场类型）不变
4. THE 新工作流 SHALL 在输出中包含原有的所有字段（stock_code、current_price、score、recommendation、analysis_report）
5. THE 新工作流 SHALL 添加新的输出字段 simplified_analysis 用于存储小白版分析

### 需求 4

**用户故事:** 作为用户，我希望小白版分析能够使用生活化的比喻和例子，以便我能更直观地理解股票走势和投资风险

#### 验收标准

1. THE 简化器节点 SHALL 使用生活化比喻解释技术指标（如用"体温计"比喻 RSI 超买超卖）
2. THE 简化器节点 SHALL 避免使用专业术语，或在使用时立即给出通俗解释
3. THE 简化器节点 SHALL 将投资建议转换为具体的行动指引（如"现在可以考虑买入"而非"技术面支持做多"）
4. THE 简化器节点 SHALL 用百分比或具体金额说明风险和收益预期
5. THE 简化器节点 SHALL 输出字数控制在 500-800 字之间，确保简洁易读
